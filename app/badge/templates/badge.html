{% extends "home_base.html" %}
{% import "badge_macros.html" as badge_macros %}

{% block title %}Perks{% endblock %}

{% block head %}
  {{ super() }}
  <link type="text/css" href="css/scroll_styles.css" rel="stylesheet">
  <link rel="stylesheet" href="css/project_styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}

{% block content %}
<div class='container my-1' style='min-width: 90%'>
  {% if ((active_competitions|length) == 1) %}
    <div class="col-md-4">
      <div class="card mb-2">
        <div class="card-body">
          <div class='float-right info-nums'>
            {{ projects.count() }}
            <i class="fa fa-circle-o" style='color:#FF5D00;'></i>
          </div>
          <div class='card-head'>
            {{ render_project_name(project, current_user) }}
            <a href='user={{ project.owner.code }}'>
              <p class='owner'>
                {{ project.owner.name }}
                {% set badge = project.owner.choose_badge('project') %}
                {% if badge %}
                  {{ render_badge_icon(badge) }}
                {% endif %}
              </p>
            </a>
          </div>
          <hr class="my-4">
          <!-- summary -->
          <div class='card-text'>
            <p class='oneliner'>
              {{ project.oneliner }}
            </p>
            <p style='color:rgba(0,0,0,0.7);'>{{ project.summary }}</p>
          </div>
          <div class='card-foot float-left'>
            <p style="padding-bottom:0px; margin-bottom:0px;">
              <i class="fa fa-clock-o"></i>
              {{ calc_days_since(now(), project.posted_on) }} / {{ project.estimated_time }}
              days
            </p>
            <div>
              {% for subject in project.subjects|reverse %}
                <a href='/subject={{ subject.code }}'>
                  {% if loop.index>1 %}
                  ,
                  {% endif %}
                  <p class='subject-tag' style='background:{{ subject.color }};'>
                    {{ subject.name }}
                  </p>
                </a>
              {% endfor %}
            </div>
          </div>
          {% if current_user.is_authenticated %}
            <br><br>
            <hr class="my-4">
            {{ render_project_action_bar(current_user, project) }}
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}
  {% if progress_tabs!=[] %}
    <h4 style='text-align:left;'>My Badges</h4>
    <hr class="my-1">
    <div id="progress-carousel" class="carousel slide carousel-multi-item" data-ride="carousel">
      <!--Slides-->
      <div class="carousel-inner" role="listbox">
        {% for tab in progress_tabs %}
          {% if loop.index==1 %}
          <div class="carousel-item active">
          {% else %}
          <div class="carousel-item">
          {% endif %}
            <div class='row'>
              {% for user_badge in tab %}
                {{ badge_macros.render_user_badge_card(user_badge) }}
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
      <!--Controls-->
      <div class="controls-top">
        <a class="btn-floating" href="#progress-carousel" data-slide="prev"><i class="fa fa-chevron-circle-left fa-lg"></i></a>
        <p id='progress-count' class='counter'>0</p>
        <a class="btn-floating" href="#progress-carousel" data-slide="next"><i class="fa fa-chevron-circle-right fa-lg"></i></a>
      </div>
      <!--/.Controls-->
    </div>
  {% endif %}

  {% if all_tabs!=[] %}
      <div id="all-carousel" class="carousel slide carousel-multi-item" data-ride="carousel">
      <h4 style='text-align:left;'>All Badges</h4>
      <hr class="my-1">
      <div class="carousel-inner" role="listbox">
        {% for tab in all_tabs %}
          {% if loop.index==1 %}
          <div class="carousel-item active">
          {% else %}
          <div class="carousel-item">
          {% endif %}
            <div class='row'>
              {% for badge in tab %}
                {{ badge_macros.render_badge_card(badge) }}
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <!--Controls-->
    {% if not request.MOBILE %}
      <div class="controls-top">
        <a class="btn-floating" href="#all-carousel" data-slide="prev"><i class="fa fa-chevron-circle-left fa-lg"></i></a>
        <p id='all-count' class='counter'>0</p>
        <a class="btn-floating" href="#all-carousel" data-slide="next"><i class="fa fa-chevron-circle-right fa-lg"></i></a>
      </div>
    {% endif %}
    <!--/.Controls-->
  {% endif %}


<script>
// log tabs
$('#progress-carousel').on('slid.bs.carousel', function () {
  $('#progress-count').html($('#progress-carousel div.active').index());
  });

$('#all-carousel').on('slid.bs.carousel', function () {
  $('#all-count').html($('#all-carousel div.active').index());
  });

// rescroll carousels doesnt do it rn because no need // WARNING: may want to later
</script>


{% endblock %}
