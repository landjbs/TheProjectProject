{% import 'macros/cards.html' as cards with context %}


<!-- CACHE RENDER CARD FUNCTIONS -->
{%
  set card_renders = dict([('project-big',cards.render_big_project_card)])
%}
<!-- /RENDER CARD FUNCTIONS -->


<!-- MACROS FOR RENDERING CAROUSELS -->

<!-- project carousel -->
{% macro render_carousel(label, id_postfix, card_type, data, interval=3000) -%}
  <!-- CACHE -->
  {% set carousel_id = 'carousel-{id_postfix}'.format(id_postfix=id_postfix) %}
  <!-- HEADER -->
  <h4 style='text-align:left;'>{{ label }}</h4>
  <hr class='my-2'>
  <!-- BODY -->
  <!-- web requests -->
  {% if not request.MOBILE %}
    <!-- carousel -->
    <div id='{{ carousel_id }}' class='carousel slide carousel-multi-item' data-ride='carousel'>
      <div class='carousel-inner' role='listbox'>
        {% for tab in data %}
          <div class='carousel-item {% if loop.index==1 %}active{% endif %}'>
            <div class='row'>
              {% for elt in tab %}
                  {{card_renders[card_type](elt) }}
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <!-- multi-page case -->
    {% if data|length > 1 %}
      <!-- cache ids -->
      {% set counter_id = 'counter-{id_postfix}'.format(id_postfix=id_postfix) %}
      {% set storage_index = 'index-{id_postfix}'.format(id_postfix=id_postfix) %}
      <!-- controls -->
      <div class="controls-top">
        <a class="btn-floating" href="#{{ carousel_id }}" data-slide="prev"><i class="fa fa-chevron-circle-left fa-lg"></i></a>
        <p id='{{ counter_id }}' class='counter'>1</p>
        <a class="btn-floating" href="#{{ carousel_id }}" data-slide="next"><i class="fa fa-chevron-circle-right fa-lg"></i></a>
      </div>
      <!-- scroll scripts -->
      <script>
        // set scroll speed
        $('#{{ carousel_id }}').carousel({
          interval: {{ interval }}
        })
        // cache scroll iterator and update counter
        $('#{{ carousel_id }}').on('slid.bs.carousel', function () {
          var count_index = $('#{{ carousel_id }} div.active').index() + 1
          sessionStorage.setItem('{{ storage_index }}', count_index);
          $('#{{ counter_id }}').html(count_index);
        });
        // rescroll on refresh
        count_index = sessionStorage.getItem('{{ storage_index }}')
        if (count_index) {
          document.getElementById('{{ carousel_id }}').carousel(1*count_index);
        }
      </script>
    {% endif %}
  <!-- mobile -->
  {% else %}
    mobile
  {% endif %}
  <!-- /RENDER CAROUSEL -->

{% endmacro -%}
<!-- /project carousel -->
