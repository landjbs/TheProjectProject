{%
  from 'macros/cards/task.html' import
    render_todo_task, render_complete_task, render_complete_task_sparse
  with context
%}
{% from 'macros/cards/comment.html' import render_comment with context %}
{% from 'macros/cards/notification.html' import render_notification with context %}

{% from 'macros/icon.html' import icon_types %}


{%
  set card_renders = dict([
    ('todo-task',             render_todo_task),
    ('complete-task',         render_complete_task),
    ('complete-task-sparse',  render_complete_task_sparse),
    ('comment',               render_comment),
    ('notification',          render_notification)
  ])
%}

{%
  set box_classes = dict([
    ('default',      'list-group'),
    ('small',        'list-group list-small'),
    ('big',          'list-group list-big')
  ])
%}

{% macro render_listbox(id_postfix, card_type, data, label=False, icon_type=False, empty_message=False, n_override=False, size='default', form=False) -%}
  {% set render_fn = card_renders[card_type] %}
  {% set n = (data|length) if data else 0 %}
  {% set boxclass =  box_classes[size] %}
  {% if label %}
    {% if size != 'small' %}
      <h4 class='tabname-big'>
    {% else %}
      <h6 class='tabname-big'>
    {% endif %}
      {{ label }}
      {% if icon_type %}
        <i class='{{ icon_types[icon_type] }}'></i>
        {% if n_override is sameas false %}
          {{ n }}
        {% else %}
          {{ n_override }}
        {% endif %}
      {% endif %}
    {% if size != 'small' %}
      </h4>
    {% else %}
  </h6>
    {% endif %}
  {% endif %}
  <div class='{{ boxclass }}'>
    {% if n==0 and empty_message %}
      <p class='empty-text'>{{ empty_message }}</p>
    {% else %}
      {% for elt in data %}
        {{ render_fn(elt) }}
      {% endfor %}
    {% endif %}
    {% if form %}
      <form class='post_form' class='form-{{ id_postfix }}' method='post' action="{{ form.render_kw['action'] }}">
        {{ form.hidden_tag() }}
        {{
          form.text(
            class='post-input', placeholder=form.render_kw['placeholder'],
            max=form.render_kw['max']
          )
        }}
      </form>
    {% endif %}
  </div>
{% endmacro -%}
