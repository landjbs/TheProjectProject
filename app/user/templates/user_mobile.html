{% extends "home_base.html" %}
{% import 'macros.html' as macros %}

{% block title %}{{ user.name }}{% endblock %}

{% block head %}
  {{ super() }}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="css/scroll_styles.css">
    <link rel="stylesheet" href="css/project_styles.css">
    <link rel='stylesheet' href="css/badge_styles.css">
{% endblock %}

{% block content %}
    <!-- PAGE -->
    <div class='container' style='min-width:100%;color:white;background:#5D00FF;'>
        <nav class='sidebar-header'>
          <p class='float-right'>
            <i class="fa fa-star"></i>
            {{ user.total_stars() }}
            <!-- edit button -->
            {% if user == current_user %}
                <br>
                <button type='button' data-toggle='modal' data-target='#edit_modal' class='edit-button'>
                  <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                  Edit
                </button>
            {% endif %}
          </p>
          <a href='/user={{ user.code }}'>
            <h3>
              {{ user.name }}
              {% set badge = user.choose_badge('search') %}
              {% if badge %}
                {{ macros.render_badge_icon_bigger(badge) }}
              {% endif %}
              {% if user.recently_active() %}
                <i class="fa fa-circle fa-sm" style='color:#00FF5D;'></i>
              {% endif %}
            </h3>
          </a>
          {% if current_user.is_authenticated %}
            <a href='mailto:{{ user.email }}'>
              {{ user.email }}
            </a>
          {% endif %}
        </div>
        <br>
        <div class='bio'>
          <p>{{ user.about }}</p>
          <center>
            <p style="margin:0px;">
              {{ user.xp }} XP
            </p>
            <div class="progress" style='width:80%;'>
              <div class="progress-bar" role="progressbar"
                  style='{{ user.xp_progressbar_width() }}'></div>
            </div>
          </center>
          <br>
        </div>
        <br>
        <div class='container' style='background:white;border-radius:5px;max-height:37vh;overflow:scroll;'>
          <h4 style='text-align:left;color:black;'>
            Owned Projects
            <i class="fa fa-circle" style='color:#FF5D00;'></i>
            {{ user.owned.count() }}
          </h4>
          {% if user.owned.count() > 0 %}
            {% for project in user.owned %}
              {% if current_user.is_authenticated %}
                {{ macros.render_big_project_card(current_user, project, now, calc_days_since) }}
              {% else %}
                {{ macros.render_anon_project_card(project, current_user) }}
              {% endif %}
            {% endfor %}
          {% else %}
            <div style='text-align:center;'>
              <a type="button" href="/add_project">
                <i class="fa fa-plus-circle fa-3x add_button" aria-hidden="true"></i>
              </a>
            </div>
          {% endif %}
        </div>
        <br>
        <div class='container' style='background:white;border-radius:5px;max-height:37vh;overflow:scroll;'>
          <h4 style='text-align:left;color:black;'>
            Member Projects
            <i class="fa fa-circle-o" style='color:#FF5D00;'></i>
            {{ (user.projects.count()) - (user.owned.count()) }}
          </h4>
          {% if ((user.projects.count()) - (user.owned.count())) > 0 %}
            {% for project in user.owned %}
              {% if not project.owner==user %}
                {% if current_user.is_authenticated %}
                  {{ macros.render_big_project_card(current_user, project, now, calc_days_since) }}
                {% else %}
                  {{ macros.render_anon_project_card(project, current_user) }}
                {% endif %}
              {% endif %}
            {% endfor %}
          {% else %}
            <div style='text-align:center;'>
              <a type="button" href="/add_project">
                <i class="fa fa-plus-circle fa-3x add_button" aria-hidden="true"></i>
              </a>
            </div>
          {% endif %}
        </div>
    </nav>

    <!-- modals -->
    <div>
      {% if current_user.is_authenticated %}
        <!-- user modal -->
        {% if current_user!=user %}
          <!-- collaborate -->
          {{ macros.render_collaborate_modal(current_user, user) }}
          {{ macros.render_report_modal(user) }}
        {% else %}
          <!-- edit and delete modals -->
          {{ macros.render_edit_user_modal(user, edit_form) }}
          {{ macros.render_delete_account_modal(user) }}
        {% endif %}
        <!-- project modals -->
        {% for tab in owned_tabs %}
          {% for project in tab %}
            {{ macros.render_join_modal(current_user, project, project_application) }}
          {% endfor %}
        {% endfor %}
      {% endif %}
    </div>
    <!-- /modals -->

    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>

  {% endblock %}
