<!-- CARDS -->
<!-- project cards -->
{% macro render_big_project_card(current_user, project, now, calc_days_since) -%}
<div class="col-md-4">
  <div class="card mb-2">
    <div class="card-body">
      <div class='float-right'>
        {{ project.members.all()|length }}
        <i class='far fa-user-circle'></i>
        <br>
        {{ project.stars.all()|length }}
        <i class="fa fa-star"></i>
      </div>
      <div class='card-head'>
        <a class='project-name' href='project={{ project.code }}'>
          <h5>{{ project.name }}</h5>
        </a>
        <a href='user={{ project.owner.email }}'>
          <p class='owner'>{{ project.owner.name }}</p>
        </a>
      </div>
      <hr class="my-4">
      <!-- summary -->
      <div class='card-text'>
        <p class='oneliner'>
          {{ project.oneliner }}
        </p>
        <p style='color:rgba(0,0,0,0.7);'>{{ project.summary }}</p>
      </div>
      <div class='card-foot float-left'>
        <p style="padding-bottom:0px; margin-bottom:0px;">
          <i class="fa fa-clock-o"></i>
          {{ calc_days_since(now(), project.posted_on) }} / {{ project.estimated_time }}
          days
        </p>
        <div>
          <!-- <i class="fa fa-flask" aria-hidden="true"></i> -->
          {% for subject in project.subjects|reverse %}
            <a href='/subject={{ subject.code }}'>
              {% if loop.index>1 %}
              ,
              {% endif %}
              <p class='subject-tag' style='background:{{ subject.color }};'>
                {{ subject.name }}
              </p>
            </a>
          {% endfor %}
        </div>
      </div>
      <br><br>
      <hr class="my-4">
      {{ render_project_action_bar(current_user, project) }}
    </div>
  </div>
</div>
{%- endmacro %}


{% macro render_mid_project_card(current_user, project, now, calc_days_since) -%}
<div class="col-md-4">
  <div class="card mb-2">
    <div class="card-body">
      <p class="float-right">
        {{ project.members.all()|length  }}
        <i class='far fa-user-circle'></i>
        <br>
        {{ project.stars.all()|length }}
        <i class="fa fa-star"></i>
      </p>
      <div class='card-head little'>
        <a class='project-name' href='project={{ project.code }}'>
          <h5>{{ project.name }}</h5>
        </a>
        <a href='user={{ project.owner.email }}'>
          <p>{{ project.owner.name }}</p>
        </a>
      </div>
      <p class='oneliner'>
        {{ project.oneliner }}
      </p>
    </div>
  </div>
</div>
{% endmacro -%}


{% macro render_small_project_card(current_user, project, now, calc_days_since) -%}
<div class="col-md-4">
  <div class="card mb-2">
    <div class="card-body">
      <div class='float-right'>
        {% if current_user==project.owner %}
          {% set pending = project.pending_members.all()|length %}
          {{ pending }}
          {% if pending>0 %}
            <i class="fa fa-bell" aria-hidden="true"></i>
          {% else %}
            <i class="fa fa-bell-o" aria-hidden="true"></i>
          {% endif %}
          <br>
        {% endif %}
        {{ project.stars.all()|length }}
        <i class="fa fa-star"></i>
      </div>
      <div class='card-head tiny'>
        <a class='project-name' href='project={{ project.code }}'>
          <h5>{{ project.name }}</h5>
        </a>
      </div>
      <!-- summary -->
      <p class='oneliner'>
        {{ project.oneliner }}
      </p>
    </div>
  </div>
</div>
{% endmacro -%}


<!-- user cards -->
{% macro render_user_card(current_user, user) -%}
<div class="col-md-4">
  <div class="card mb-2">
    <div class="card-body">
      <div class='card-head little'>
        <a class='project-name' href='user={{ user.email }}'>
          <h5>{{ user.name }}</h5>
        </a>
        <a href='mailto:{{ user.email }}'>
          <p>{{ user.email }}</p>
        </a>
      </div>
      <p class='oneliner'>
        {{ user.about }}
      </p>
      <div class='card-foot float-left'>
        <!-- <i class="fa fa-flask" aria-hidden="true"></i> -->
        {% for s in (user.subjects|reverse)[:5] %}
          <a href='/subject={{ s.subject.code }}'>
            {% if loop.index>1 %}
            ,
            {% endif %}
            <p class='subject-tag' style='background:{{ s.subject.color }};'>
              {{ s.subject.name }}
            </p>
          </a>
        {% endfor %}
      </div>
      <br>
      {% if current_user!=user %}
        <hr class="my-4">
        {{ render_user_action_bar(current_user, user) }}
      {% endif %}
    </div>
  </div>
</div>
{% endmacro -%}


<!-- subject cards -->
{% macro render_subject_card(subject) -%}
<div class="col-md-4">
  <a class='project-name' href='subject={{ subject.code }}'>
    <div class="card mb-2">
      <div class="card-body"
      style='background: {{ subject.color }}'>
        <p class="float-right" style='color:white;'>
          {{ subject.projects.all()|length  }}
          <i class='fa fa-circle'></i>
          <br>
          {{ subject.users|length  }}
          <i class='fa fa-user-circle'></i>
        </p>
        <div class='card-head tiny'>
          <h5 style='color:white;'>{{ subject.name }}</h5>
        </div>
      </div>
    </div>
  </a>
</div>
{% endmacro -%}


<!-- BUTTONS -->
{% macro render_join_button(current_user, project) -%}
  {% if not current_user in project.members %}
    <button type="button" class="btn" data-toggle="modal" data-target="#modal_project_{{ project.id }}">
        Join
    </button>
  {% elif current_user.has_applied(project) %}
      Pending
  {% else %}
    <button type="button" class="btn" data-toggle="modal" data-target="#modal_project_{{ project.id }}">
        Leave
    </button>
  {% endif %}
{% endmacro -%}


{% macro render_collaborate_button(current_user, target_user) -%}
  <button type="button" class="btn" data-toggle="modal" data-target="#modal_user_{{ target_user.id }}">
      Collab
  </button>
{% endmacro -%}


{% macro render_project_action_bar(current_user, project) -%}
<div class='action-bar'>
  {% if current_user in project.stars %}
    <a href="{{ url_for('like_action', project_id=project.id, action='unlike') }}">
      <i class="fa fa-star"></i>
    </a>
  {% else %}
    <a href="{{ url_for('like_action', project_id=project.id, action='like') }}">
      <i class="fa fa-star-o"></i>
    </a>
  {% endif %}
  &nbsp;
  {{ render_join_button(current_user, project) }}
  &nbsp;
  {{ render_project_share_button(project) }}
</div>
{% endmacro -%}



{% macro render_user_action_bar(current_user, target_user) -%}
<div class='action-bar'>
  {% if current_user!= target_user %}
    <div class='hoverable'>
      <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
      <span class='tooltiptext'>
        <a href="{{ url_for('report_user', target_user_id=target_user.id) }}">
          Report User
        </a>
      </span>
    </div>
    &nbsp;
    {{ render_collaborate_button(current_user, target_user) }}
    &nbsp;
    {{ render_user_share_button(target_user) }}
  {% endif %}
</div>
{% endmacro -%}


{% macro render_project_share_button(project) -%}
  <div class='hoverable'>
    <i class="fa fa-share-alt" aria-hidden="false"></i>
    <span class='tooltiptext'>
      <a class="twitter-share-button"
          href="https://twitter.com/share?url=https://theprojectproject.io/project={{ project.code }}"
          data-size="large">
        <i class="fa fa-twitter" aria-hidden="true"></i>
      </a>
      <a class="twitter-share-button"
          href="https://twitter.com/share?url=https://theprojectproject.io/project={{ project.code }}"
          data-size="large">
        <i class="fa fa-instagram" aria-hidden="true"></i>
      </a>
      <a class="twitter-share-button"
          href="https://twitter.com/share?url=https://theprojectproject.io/project={{ project.code }}"
          data-size="large">
        <i class="fa fa-facebook-square" aria-hidden="true"></i>
      </a>
    </span>
  </div>
{% endmacro -%}


{% macro render_user_share_button(user) -%}
  <div class='hoverable'>
    <i class="fa fa-share-alt" aria-hidden="false"></i>
    <span class='tooltiptext'>
      <a class="twitter-share-button"
          href="https://twitter.com/share?url=https://theprojectproject.io/user={{ user.email }}"
          data-size="large">
        <i class="fa fa-twitter" aria-hidden="true"></i>
      </a>
      <a class="twitter-share-button"
          href="https://twitter.com/share?url=https://theprojectproject.io/user={{ user.email }}"
          data-size="large">
        <i class="fa fa-instagram" aria-hidden="true"></i>
      </a>
      <a class="twitter-share-button"
          href="https://twitter.com/share?url=https://theprojectproject.io/user={{ user.email }}"
          data-size="large">
        <i class="fa fa-facebook-square" aria-hidden="true"></i>
      </a>
      <a class="twitter-share-button"
          href="https://twitter.com/share?url=https://theprojectproject.io/user={{ user.email }}"
          data-size="large">
          <i class="fa fa-envelope" aria-hidden="true"></i>
      </a>
    </span>
  </div>
{% endmacro -%}


<!-- MODALS -->
{% macro render_join_modal(current_user, project, project_application) -%}
    {% if not current_user in project.members %}
      <div id="modal_project_{{ project.id }}" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <a href='project={{ project.code }}' style='color:black;'>
                <h5>{{ project.name }}</h5>
              </a>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form action="{{ url_for('join_project', project_id=project.id) }}" method='post'>
              <div class="modal-body">
                {% if project.requires_application %}
                  "{{ project.application_question }}"</p>
                    {{ project_application.hidden_tag() }}
                    {{ project_application.response(class='join-input', placeholder='Response', required=True) }}
                {% else %}
                  <p>Welcome to {{ project.name }}! Click to join.</p>
                {% endif %}
              </div>
              <div class="modal-footer">
                <button class='btn'>Join</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    {% else %}
      <div id="modal_project_{{ project.id }}" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <a href='project={{ project.code }}' style='color:black;'>
                <h5>{{ project.name }}</h5>
              </a>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form action="{{ url_for('leave_project', project_id=project.id) }}" method='post'>
                <div class="modal-body">
                  {% if project.owner==current_user %}
                    {% if project.members.all()|length>1 %}
                      <label for="new_owner">Select new project owner:</label>
                      <br>
                      <select name="new_owner" id="new_owner" class='select-clean'>
                        {% for member in project.members %}
                          {% if not member==project.owner %}
                            <option value="{{ member.id }}">{{ member.name }}</option>
                          {% endif %}
                        {% endfor %}
                      </select>
                    {% else %}
                      <p>
                        If you leave {{ project.name }}, there will be no members left and the
                        project will be deleted. Are you sure you want to leave?
                      </p>
                    {% endif %}
                  {% else %}
                    <p>Are you sure you want to leave {{ project.name }}?</p>
                  {% endif %}
                </div>
                <div class="modal-footer">
                  <button class='btn'>Leave</button>
                </div>
              </form>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
{%- endmacro %}


{% macro render_collaborate_modal(current_user, target_user) -%}
<div id="modal_user_{{ target_user.id }}" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <a href='user={{ target_user.email }}' style='color:black;'>
          <h5>{{ target_user.name }}</h5>
        </a>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      {% if (current_user.owned|length)>0 %}
      <form action="{{ url_for('collaborate', target_user_id=target_user.id) }}" method='post'>
        <div class="modal-body">
          <label for="new_owner">Select project on which to collaborate with {{ target_user.name }}:</label>
          <br>
          <select name="selected_project" id="selected_project" class='select-clean'>
            {% for project in current_user.owned %}
              <option value="{{ project.id }}">{{ project.name }}</option>
            {% endfor %}
          </select>
          <br><br>
          <p>{{ target_user.name }} will be sent an invitation
            and will be able to join without applying.
          </p>
        </div>
        <div class="modal-footer">
          <button class='btn'>Collaborate</button>
        </div>
      </form>
      {% else %}
        <div class="modal-body">
          <p>Cannot invite {{ target_user.name }} to collaborate because
            you do not own any projects! Try <a href='/add_project'>adding a project</a> first.
          </p>
        </div>
        <div class="modal-footer">
          <a href='/add_project'>
            <button class='btn'>Add Project</button>
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endmacro -%}
