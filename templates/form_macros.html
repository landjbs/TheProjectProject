<!-- SELECTS -->
{% macro render_multiselect(field) -%}

  {{ field(id=field.name, style='display:none;') }}
  <span class="select_subject" id='{{ field.name }}_select' name='{{ field.name }}'></span>
  {% if field.errors %}
    <p class='warning'>{{ field.errors[0] }}</p>
  {% else %}
    <small>Limit {{ field.render_kw['max'] }}.</small>
  {% endif %}

  <script>
    // multiselect
    const subjects = [];
    {% for elt in field.choices %}
      subjects.push({label: '{{ elt[1] }}',
                     value: '{{ elt[0] }}'},)
    {% endfor %}

    var instance = new SelectPure(".select_subject", {
        options: subjects,
        multiple: true,
        autocomplete: true,
        icon: "fa fa-times",
        inlineIcon: false,
        placeholder: false,
        onChange: value => { if (value.length>{{ field.render_kw['max'] }}) {
                              var last_elt = document.querySelectorAll('.select-pure__selected-label');
                              last_elt[last_elt.length - 1].style.color='red';
                              last_elt[last_elt.length - 1].style.borderColor='red';
                            };
                          },
        classNames: {
          select: "select-pure__select",
          dropdownShown: "select-pure__select--opened",
          multiselect: "select-pure__select--multiple",
          label: "select-pure__label",
          placeholder: "select-pure__placeholder",
          dropdown: "select-pure__options",
          option: "select-pure__option",
          autocompleteInput: "select-pure__autocomplete",
          selectedLabel: "select-pure__selected-label",
          selectedOption: "select-pure__option--selected",
          placeholderHidden: "select-pure__placeholder--hidden",
          optionHidden: "select-pure__option--hidden",
        }
    });
  </script>

{% endmacro -%}
