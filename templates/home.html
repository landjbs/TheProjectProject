{% extends "home_base.html" %} {% import 'macros.html' as macros %}
{% block title %}Home{% endblock %}

{% block head %}
  {{ super() }}
  <link type="text/css" href="css/scroll_styles.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}

{% block content %}
<div class='container my-4' style='min-width: 90%'>
  <h4 style='text-align:left;'>Recommended Projects</h4>
  <hr class="my-4">
  <div id="rec-carousel" class="carousel slide carousel-multi-item" data-ride="carousel">
    <!--Slides-->
    <div class="carousel-inner" role="listbox">
      {% for tab in recommended_tabs %}
        {% if loop.index==1 %}
        <div class="carousel-item active">
        {% else %}
        <div class="carousel-item">
        {% endif %}
          <div class='row'>
            {% for project in tab %}
              {{ macros.render_big_project_card(current_user, project, now, calc_days_since) }}
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
    <!--Controls-->
    <div class="controls-top">
      <a class="btn-floating" href="#rec-carousel" data-slide="prev"><i class="fa fa-chevron-circle-left fa-lg"></i></a>
      <a class="btn-floating" href="#rec-carousel" data-slide="next"><i class="fa fa-chevron-circle-right fa-lg"></i></a>
    </div>
    <!--/.Controls-->
  </div>

  <div id="trending-carousel" class="carousel slide carousel-multi-item" data-ride="carousel">
    <h4 style='text-align:left;'>Trending Projects</h4>
    <hr class="my-4">
    <div class="carousel-inner" role="listbox">
      {% for tab in top_tabs %}
        {% if loop.index==1 %}
        <div class="carousel-item active">
        {% else %}
        <div class="carousel-item">
        {% endif %}
          <div class='row'>
            {% for project in tab %}
              <div class="col-md-4">
                <div class="card mb-2">
                  <div class="card-body">
                    <p class="float-right">
                      <i class='far fa-user-circle'></i>
                      {{ project.members.all()|length  }}
                      <br>
                      <i class="fa fa-star"></i>
                      {{ project.stars.all()|length }}
                    </p>
                    <div class='card-head little'>
                      <a class='project-name' href='project={{ project.name }}'>
                        <h5>{{ project.name }}</h5>
                      </a>
                      <a href='user={{ project.owner.email }}'>
                        <p>{{ project.owner.name }}</p>
                      </a>
                    </div>
                    <p class='oneliner'>
                      {{ project.oneliner }}
                    </p>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  <!--Controls-->
  <div class="controls-top">
    <a class="btn-floating" href="#trending-carousel" data-slide="prev"><i class="fa fa-chevron-circle-left fa-lg"></i></a>
    <a class="btn-floating" href="#trending-carousel" data-slide="next"><i class="fa fa-chevron-circle-right fa-lg"></i></a>
  </div>
  <!--/.Controls-->

  <h4 style='text-align:left;'>My Projects</h4>
  <hr class="my-4">
  {% if user_project_count>0 %}
    <div id="my-carousel" class="carousel slide carousel-multi-item" data-ride="carousel">
      <!--Slides-->
      <div class="carousel-inner" role="listbox">
        {% for tab in user_tabs %}
          {% if loop.index==1 %}
          <div class="carousel-item active">
          {% else %}
          <div class="carousel-item">
          {% endif %}
            <div class='row'>
              {% for project in tab %}
                <div class="col-md-4">
                  <div class="card mb-2">
                    <div class="card-body">
                      <div class='float-right'>
                        {% if current_user==project.owner %}
                          {% set pending = project.pending_members.all()|length %}
                          {% if pending>0 %}
                            <i class="fa fa-bell" aria-hidden="true"></i>
                          {% else %}
                            <i class="fa fa-bell-o" aria-hidden="true"></i>
                          {% endif %}
                          {{ pending }}
                          <br>
                        {% endif %}
                        <i class="fa fa-star"></i>
                        {{ project.stars.all()|length }}
                      </div>
                      <div class='card-head tiny'>
                        <a class='project-name' href='project={{ project.name }}'>
                          <h5>{{ project.name }}</h5>
                        </a>
                      </div>
                      <!-- summary -->
                      <p class='oneliner'>
                        {{ project.oneliner }}
                      </p>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% else %}
  <div style='text-align:center;'>
    <a type="button" href="/add_project">
      <i class="fa fa-plus-circle fa-3x add_button" aria-hidden="true"></i>
    </a>
  </div>
  {% endif %}
</div>
<!--Controls-->
<div class="controls-top">
  <a class="btn-floating" href="#my-carousel" data-slide="prev"><i class="fa fa-chevron-circle-left fa-lg"></i></a>
  <a class="btn-floating" href="#my-carousel" data-slide="next"><i class="fa fa-chevron-circle-right fa-lg"></i></a>
</div>
<!--/.Controls-->

<div>
  {% for tab in recommended_tabs %}
    {% for project in tab %}
      {{ macros.render_join_modal(current_user, project, project_application) }}
    {% endfor %}
  {% endfor %}
</div>



<script>
// log tabs
$('#rec-carousel').on('slid.bs.carousel', function () {
  sessionStorage.setItem('recSlide', $('#rec-carousel div.active').index());
  });

$('#trending-carousel').on('slid.bs.carousel', function () {
  sessionStorage.setItem('trendingSlide', $('#trending-carousel div.active').index());
  });

$('#my-carousel').on('slid.bs.carousel', function () {
  sessionStorage.setItem('mySlide', $('#my-carousel div.active').index());
  });

// rescroll carousels
if(sessionStorage.recSlide){
    $("#rec-carousel").carousel(sessionStorage.recSlide*1);
  }

if(sessionStorage.trendingSlide){
    $("#trending-carousel").carousel(sessionStorage.trendingSlide*1);
  }

if(sessionStorage.mySlide){
    $("#my-carousel").carousel(sessionStorage.mySlide*1);
  }
</script>


{% endblock %}
