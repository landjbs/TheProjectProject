{% extends "home_base.html" %}
{% import 'macros.html' as macros %}
{% block title %}Home{% endblock %}

{% block head %}
  {{ super() }}
  <link type="text/css" href="css/scroll_styles.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}

{% block content %}
<div class='container my-4'>
  <h3>Results for "{{ search_text }}"<h3>
  <hr class="my-4">
  <h4 style='text-align:left;'>Projects</h4>
  <hr class="my-4">
  <div id="rec-carousel" class="carousel slide carousel-multi-item" data-ride="carousel">
    <!--Slides-->
    <div class="carousel-inner" role="listbox">
      {% for tab in project_tabs %}
        {% if loop.index==1 %}
        <div class="carousel-item active">
        {% else %}
        <div class="carousel-item">
        {% endif %}
          <div class='row'>
            {% for project in tab %}
              {{ macros.render_big_project_card(current_user, project, now, calc_days_since) }}
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
    <!--Controls-->
    <div class="controls-top">
      <a class="btn-floating" href="#rec-carousel" data-slide="prev"><i class="fa fa-chevron-circle-left fa-lg"></i></a>
      <a class="btn-floating" href="#rec-carousel" data-slide="next"><i class="fa fa-chevron-circle-right fa-lg"></i></a>
    </div>
    <!--/.Controls-->
  </div>
  </div>

<div id="trending-carousel" class="carousel slide carousel-multi-item" data-ride="carousel">
<div class='container my-4'>
  <h4 style='text-align:left;'>Users</h4>
  <hr class="my-4">
  <div class="carousel-inner" role="listbox">
    {% for tab in user_tabs %}
      {% if loop.index==1 %}
      <div class="carousel-item active">
      {% else %}
      <div class="carousel-item">
      {% endif %}
        <div class='row'>
          {% for user in tab %}
            {{ macros.render_user_card(user) }}
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<div class='container my-4'>
  <h4 style='text-align:left;'>Subjects</h4>
  <hr class="my-4">
    <div id="my-carousel" class="carousel slide carousel-multi-item" data-ride="carousel">
      <!--Slides-->
      <div class="carousel-inner" role="listbox">
        {% for tab in subject_tabs %}
          {% if loop.index==1 %}
          <div class="carousel-item active">
          {% else %}
          <div class="carousel-item">
          {% endif %}
            <div class='row'>
              {% for subject in tab %}
                {{ macros.render_subject_card(subject) }}
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
</div>



</div>
</div>

<div>
  {% for tab in project_tabs %}
    {% for project in tab %}
      {% if not is_project_member(current_user, project) %}
        <div id="modal_{{ project.id }}" class="modal fade" role="dialog">
          <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
              </div>
              <div class="modal-body">
                {% if project.requires_application %}
                  <p>{{ project.application_question }}</p>
                  {{ project_application.hidden_tag() }}
                  {{ project_application.response(placeholder='Response') }}
                {% else %}
                  <p>Welcome to {{ project.name }}!</p>
                {% endif %}
                <a class='btn' href="{{ url_for('join_project', project_id=project.id) }}">
                  Join
                </a>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <div id="modal_{{ project.id }}" class="modal fade" role="dialog">
          <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
              </div>
              <div class="modal-body">
                <p>Are you sure you want to leave {{ project.name }}?</p>
                <a class='btn' href="{{ url_for('leave_project', project_id=project.id, new_owner_id=1) }}">
                  Leave
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  {% endfor %}
</div>



<script>
$('#rec-carousel').on('slid.bs.carousel', function () {
var currentSlide = $('#rec-carousel div.active').index();
sessionStorage.setItem('lastSlide', currentSlide);
});
if(sessionStorage.lastSlide){
  $("#rec-carousel").carousel((sessionStorage.lastSlide+1)*1);
}

// $('#rec-carousel').bind('mousewheel', function() {
//     $(this).carousel('next');
// });
</script>
{% endblock %}
